{
  "security_score": 100,
  "active_issues": [
    {
      "type": "Proactive - error",
      "description": "Critical import errors for standard libraries (io, json) and PIL.Image indicate a broken Python environment, blocking application execution.",
      "severity": "High",
      "priority_score": 4
    }
  ],
  "project_charter": {
    "initialized": true,
    "project_name": "Vibe Assist",
    "description": "A comprehensive code monitoring and security analysis tool that combines a Python AI backend (Daemon), a Next.js web application/API bridge, and a native macOS widget. It provides real-time security vulnerability detection, AI-powered commit analysis, and proactive coding suggestions by monitoring git repositories and screen activity. The system has been simplified by removing the user feedback loop. Proactive screen analysis now provides broader coding assistance (errors, refactoring, improvements) and uses an AI-powered triage system to deduplicate and prioritize suggestions. The system can automatically track and mark charter goals as complete based on commit content. It can also perform a one-time, lightweight analysis of a codebase to generate a baseline project context document.",
    "tech_stack": [
      "Python",
      "FastAPI",
      "Google Gemini AI",
      "Next.js",
      "React",
      "TypeScript",
      "Swift",
      "WidgetKit (macOS)",
      "Turborepo",
      "pnpm"
    ],
    "key_directories": {
      "apps/daemon": "The core Python backend service responsible for all AI analysis, git monitoring, and screen capture.",
      "apps/web": "The Next.js web application that serves as a dashboard and an API bridge between the Python daemon and the macOS widget.",
      "apps/widget": "The native macOS widget written in Swift, which displays the final analysis results.",
      "apps/docs": "A separate Next.js application for project documentation.",
      "packages/ui": "Shared React components used across the Next.js applications.",
      "packages/eslint-config": "Shared ESLint configurations for the monorepo.",
      "packages/typescript-config": "Shared TypeScript configurations for the monorepo.",
      ".vibe-assist": "Stores project-specific data generated by the tool, such as the `context.md` file. This directory should be excluded from version control."
    },
    "charter_items": [
      {
        "goal": "Provide real-time security vulnerability detection on uncommitted code changes.",
        "completed": false,
        "completed_by_commit": ""
      },
      {
        "goal": "Analyze new commits to evolve the project charter document and automatically mark relevant goals as complete.",
        "completed": false,
        "completed_by_commit": ""
      },
      {
        "goal": "Offer proactive, general-purpose coding suggestions (e.g., bugs, refactoring, improvements) by analyzing the developer's screen.",
        "completed": false,
        "completed_by_commit": ""
      },
      {
        "goal": "Expose a clean REST API for integration with frontends and widgets.",
        "completed": false,
        "completed_by_commit": ""
      },
      {
        "goal": "Maintain a simple in-memory state representing the project's health and security status, known as 'Project Cortex'.",
        "completed": false,
        "completed_by_commit": ""
      },
      {
        "goal": "Bridge the backend analysis to a native macOS widget for ambient monitoring.",
        "completed": false,
        "completed_by_commit": ""
      },
      {
        "goal": "Enable AI-powered prompt engineering to assist developers with complex tasks.",
        "completed": false,
        "completed_by_commit": ""
      },
      {
        "goal": "Perform a one-time, lightweight analysis of the codebase to generate a baseline project context document.",
        "completed": false,
        "completed_by_commit": ""
      }
    ],
    "architecture_overview": "Vibe Assist uses a three-tier architecture. The Python Daemon (`apps/daemon`) acts as the core intelligence, running a multi-threaded FastAPI server for git and screen monitoring. It communicates with the Google Gemini API for analysis. A key feature is the ability for the daemon to analyze commits and automatically update the completion status of its own charter goals. The system's proactive screen analysis has been broadened to provide general coding suggestions, which are then processed by an AI-powered triage module for deduplication and prioritization before being added to the in-memory state. The user feedback system has been removed to simplify the state management model.",
    "api_endpoints": [
      {
        "path": "/api/checklist",
        "method": "GET",
        "purpose": "Exposed by the Next.js app (`apps/web`) for the macOS widget. It fetches state from the Python daemon and transforms it into a widget-friendly checklist format."
      },
      {
        "path": "/state",
        "method": "GET",
        "purpose": "Exposed by the Python daemon (`apps/daemon`). Returns the current in-memory state of the monitored project, including security score and active issues."
      },
      {
        "path": "/health",
        "method": "GET",
        "purpose": "Exposed by the Python daemon. A simple health check to verify the service is running and the Gemini client is initialized."
      },
      {
        "path": "/oracle/generate_prompt",
        "method": "POST",
        "purpose": "Exposed by the Python daemon. An AI prompt engineering endpoint that takes a user's goal and a screenshot to generate an optimized, unstructured text prompt for another AI model."
      },
      {
        "path": "/docs",
        "method": "GET",
        "purpose": "Exposed by the Python daemon. Serves interactive FastAPI documentation (Swagger UI)."
      },
      {
        "path": "/context/initialize",
        "method": "POST",
        "purpose": "Exposed by the Python daemon. Triggers a lightweight analysis of the codebase to generate a baseline `context.md` file and initialize the project charter in memory."
      }
    ],
    "key_functions": [
      {
        "name": "main",
        "location": "apps/daemon/src/daemon.py",
        "purpose": "The main entry point for the Python daemon. It initializes state, starts background threads for watching and screen analysis, and runs the FastAPI server."
      },
      {
        "name": "analyze_fast_path",
        "location": "apps/daemon/src/analysis.py",
        "purpose": "Performs rapid security analysis on uncommitted git diffs. No longer uses a strict JSON schema for the response."
      },
      {
        "name": "analyze_deep_path",
        "location": "apps/daemon/src/analysis.py",
        "purpose": "Performs analysis of a new git commit to update the project charter document and automatically marks charter goals as complete if the commit satisfies their criteria."
      },
      {
        "name": "analyze_screen_proactively",
        "location": "apps/daemon/src/analysis.py",
        "purpose": "Analyzes a screenshot of the developer's screen to identify potential coding issues, bugs, or improvements. It then sends any findings to the `triage_suggestions` function before adding them to the active issues list."
      },
      {
        "name": "triage_suggestions",
        "location": "apps/daemon/src/analysis.py",
        "purpose": "Uses an AI prompt to deduplicate new proactive suggestions against existing issues and assign a priority score (1-5). Acts as a filter to prevent redundant suggestions from being added to the state."
      },
      {
        "name": "initialize_project_context",
        "location": "apps/daemon/src/analysis.py",
        "purpose": "Performs a one-time, lightweight scan of the codebase using git and file system commands to generate an initial project charter and a `context.md` file."
      },
      {
        "name": "start (watcher)",
        "location": "apps/daemon/src/watcher.py",
        "purpose": "The main loop in the watcher thread. It continuously checks for uncommitted changes and new commits in the target git repository."
      },
      {
        "name": "start (screen)",
        "location": "apps/daemon/src/screen.py",
        "purpose": "The main loop in the screen analysis thread. It periodically captures the screen and sends it for proactive analysis."
      },
      {
        "name": "GET (checklist route)",
        "location": "apps/web/app/api/checklist/route.ts",
        "purpose": "The Next.js API route handler that fetches data from the daemon's `/state` endpoint and formats it for the macOS widget, providing a fallback if the daemon is unavailable."
      }
    ],
    "component_interactions": [
      {
        "from_component": "macOS Widget",
        "to_component": "Next.js Web App",
        "interaction_type": "API Call",
        "description": "The Swift widget sends a GET request to `/api/checklist` every 15 minutes to refresh its data."
      },
      {
        "from_component": "Next.js Web App",
        "to_component": "Python Daemon",
        "interaction_type": "API Call",
        "description": "The `/api/checklist` route handler makes a GET request to the daemon's `/state` endpoint to fetch real-time analysis data."
      },
      {
        "from_component": "Watcher Thread (Daemon)",
        "to_component": "Analysis Module (Daemon)",
        "interaction_type": "Function Call",
        "description": "The watcher thread detects git changes and calls `analysis.analyze_fast_path()` or `analysis.analyze_deep_path()` with the diff content."
      },
      {
        "from_component": "Screen Thread (Daemon)",
        "to_component": "Analysis Module (Daemon)",
        "interaction_type": "Function Call",
        "description": "The screen thread captures a screenshot and calls `analysis.analyze_screen_proactively()` with the image bytes."
      },
      {
        "from_component": "Analysis Module (Daemon)",
        "to_component": "Google Gemini API",
        "interaction_type": "External API Call",
        "description": "All analysis functions within the `analysis` module make authenticated requests to the Google Gemini AI API to generate insights."
      },
      {
        "from_component": "Analysis Module (Daemon)",
        "to_component": "In-Memory State",
        "interaction_type": "State Mutation",
        "description": "Analysis functions acquire a thread lock and update the shared `state` dictionary. Proactive screen analysis appends triaged and prioritized suggestions. Commit analysis (`analyze_deep_path`) can now update the completion status of `charter_items` in the state."
      }
    ],
    "coding_patterns": [
      "Monorepo with Shared Packages: Uses Turborepo and pnpm workspaces to manage multiple applications and share code (UI components, configs).",
      "Multi-threaded Background Tasks: The Python daemon uses threading to run concurrent, non-blocking tasks for git watching and screen analysis.",
      "In-Memory State Management with Thread Lock: A global dictionary serves as the single source of truth, with a `threading.Lock` to ensure thread-safe updates. The state schema is simplified by the removal of the user feedback system. Proactive suggestions are deduplicated and prioritized by an AI triage function before being added to the state.",
      "API Gateway / Bridge Pattern: The Next.js app acts as a bridge, providing a stable, simplified API for the widget while abstracting the more complex backend daemon.",
      "Simplified AI Interaction without Strict Schemas: Relies on general text or simple JSON responses from the AI model, removing the overhead of strict schema validation frameworks like Pydantic.",
      "Environment-based Configuration: The application relies on `.env` files and environment variables for configuration, such as API keys and server ports.",
      "Graceful Fallback: The Next.js API provides a fallback response when the backend daemon is unavailable, ensuring the widget displays a helpful message instead of failing.",
      "Separation of Source Code and Generated Artifacts: Generated files such as `context.md` and state dumps are stored in the `.vibe-assist` directory, which is intended to be excluded from version control."
    ],
    "development_setup": "The project is a monorepo managed by pnpm and Turborepo. To set up, run `pnpm install` in the root. For the Python daemon in `apps/daemon`, create and activate a virtual environment, then run `pip install -r requirements.txt`. An essential `GEMINI_API_KEY` environment variable must be set. It is recommended to add the `.vibe-assist/` directory to the project's `.gitignore` file. Start the system with the Python daemon (`python -m src.daemon /path/to/project`) and the Next.js app (`pnpm dev`). The web app runs on port 3000, the daemon on port 8000. To initialize the project context for the first time, send a POST request to `http://localhost:8000/context/initialize`."
  },
  "last_analyzed_commit": "11efcaf7c4361dd059e2ddfb3be79f4179942829",
  "user_feedback": {
    "dismissed_issues": [
      {
        "description": "The IDE shows a suggestion (lightbulb icon) for the empty 'active_issues' array, potentially indicating a way to track or manage new issues.",
        "type": "Proactive - improvement",
        "dismissed_at": 1762640520.0396101,
        "note": "Not important"
      },
      {
        "description": "The terminal shows an \"Auto-update failed\" error message, suggesting to run \"claude doctor\" or \"npm i -g @anthropic-ai/claude-code\".",
        "type": "Proactive - error",
        "dismissed_at": 1762640528.637666,
        "note": "Not important"
      },
      {
        "description": "The current state summary in the terminal reports a \"[High] P5 - Proactive - error: ...\" requiring immediate attention.",
        "type": "Proactive - error",
        "dismissed_at": 1762640529.72364,
        "note": "Not important"
      },
      {
        "description": "The IDE shows a lightbulb suggestion icon next to the 'CharterItem' class definition, indicating a potential refactoring or code improvement opportunity.",
        "type": "Proactive - refactoring",
        "dismissed_at": 1762640530.37838,
        "note": "Not important"
      }
    ],
    "false_positives": []
  }
}