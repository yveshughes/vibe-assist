# Project Context: Vibe Assist

## Overview
An AI-powered development assistant that monitors a codebase for security vulnerabilities, analyzes code changes against project goals, and provides proactive suggestions. It features a Python backend for analysis, a Next.js dashboard for visualization, and a native macOS widget for ambient status updates, aiming to keep project context synchronized across developers and AI tools.

## Architecture
Vibe Assist uses a three-component architecture. The core is a Python 'daemon' (apps/daemon) running on port 8000, which performs all the heavy lifting: it monitors a local Git repository for changes, captures screen content, and sends this data to the Google Gemini API for analysis. This daemon maintains the application's central state, including security scores and active issues, and exposes it via a FastAPI REST API.

The second component is a Next.js web application (apps/dashboard) on port 3001, which serves two purposes. It provides a rich web dashboard for users to view the detailed state from the daemon. It also acts as an API bridge, exposing a simplified endpoint (/api/checklist) specifically for the widget. This bridge fetches data from the daemon's /state endpoint and formats it.

The third component is a native macOS widget (apps/widget), which is the primary user-facing element for ambient monitoring. It polls the Next.js API bridge every few minutes to get the latest status and displays it in the macOS Notification Center or on the desktop.

## Technology Stack
- Python
- FastAPI
- Google Gemini
- Next.js
- React
- TypeScript
- Swift
- WidgetKit
- Turborepo
- pnpm

## Key Directories
- **apps/daemon**: The core Python backend service using FastAPI for AI analysis, Git monitoring, and screen capture.
- **apps/dashboard**: The Next.js web application that serves the user dashboard UI and acts as an API bridge to the widget.
- **apps/widget**: The native Swift and WidgetKit code for the macOS widget.
- **apps/web**: A public-facing landing page built with Vite and React.
- **docs/**: Project documentation, including setup guides and architecture overviews.
- **packages/**: Shared monorepo packages for UI components, ESLint, and TypeScript configurations.

## Project Goals
- ⬜ Provide real-time security vulnerability detection on uncommitted code changes.
- ⬜ Offer AI-powered commit analysis to ensure alignment with project goals and auto-update project context.
- ⬜ Deliver proactive coding suggestions and bug detection through periodic screen analysis.
- ⬜ Bridge backend analysis to a native macOS widget for ambient, at-a-glance monitoring.
- ⬜ Maintain a comprehensive, auto-updating project context document (context.vibe) from the codebase.
- ⬜ Provide a web dashboard for detailed review of security scores, active issues, and charter progress.
- ⬜ Enable AI-assisted prompt engineering through an 'Oracle' feature that uses screenshots and project context.

## API Endpoints
- **GET /health**: Health check for the Python daemon.
- **GET /state**: Retrieves the current state from the daemon, including security score, active issues, and project charter.
- **POST /oracle/generate_prompt**: Generates an optimized AI prompt based on a user's goal and a screenshot.
- **POST /feedback**: Allows the user to submit feedback on an issue (e.g., dismiss, mark as false positive).
- **POST /issues/clear**: Clears all active issues in the daemon's state.
- **GET /api/checklist**: A Next.js API route that fetches state from the daemon and transforms it into a simplified format for the macOS widget.

## Key Functions & Classes
- **main()** (`apps/daemon/src/daemon.py`): The main entry point for the Python daemon. It initializes state, starts the watcher and screen analysis background threads, and runs the FastAPI server.
- **initialize_project_context_full()** (`apps/daemon/src/analysis.py`): Performs a one-time, comprehensive scan of the entire codebase using a powerful AI model to generate the initial project charter and context.
- **analyze_fast_path()** (`apps/daemon/src/analysis.py`): Analyzes uncommitted Git diffs for high-priority security vulnerabilities using a fast AI model.
- **analyze_deep_path()** (`apps/daemon/src/analysis.py`): Analyzes new commits to intelligently update the project charter, keeping the project context document current.
- **analyze_screen_proactively()** (`apps/daemon/src/analysis.py`): Uses a multimodal AI model to analyze screenshots for potential bugs, errors, or refactoring opportunities, providing proactive assistance.
- **start()** (`apps/daemon/src/watcher.py`): The main loop for the Git watcher thread. It detects uncommitted changes for fast-path analysis and new commits for deep-path analysis.
- **GET()** (`apps/dashboard/app/api/checklist/route.ts`): The Next.js API route handler that bridges the daemon's state to the macOS widget, providing a stable, simplified data contract and a fallback mechanism.
- **Home()** (`apps/dashboard/app/page.tsx`): The main React component for the web dashboard UI, responsible for fetching state from the daemon API and rendering the security score and issue list.

## Component Interactions
- **macOS Widget** → **Next.js Dashboard** (API Call): The Swift widget sends a GET request to the `/api/checklist` endpoint every 5 minutes to refresh its status display.
- **Next.js Dashboard** → **Python Daemon** (API Call): The Next.js backend (for the widget API) and frontend (for the dashboard UI) make GET requests to the daemon's `/state` endpoint to fetch the latest analysis data.
- **Python Daemon (analysis.py)** → **Google Gemini API** (External API Call): The analysis module makes requests to the Gemini API (Flash and Pro models) to perform security scans, charter updates, and screen analysis.
- **Python Daemon (watcher.py)** → **Local Git Repository** (File System Read): The watcher thread uses the GitPython library to read commit history and file diffs from the monitored project directory.
- **Python Daemon (screen.py)** → **Operating System** (System Call): The screen analyzer thread uses the `mss` library to capture screenshots of the user's primary display for proactive analysis.
- **Web Dashboard UI** → **Python Daemon** (API Call): The user interacts with the dashboard to send feedback or clear issues, which triggers POST/DELETE requests to endpoints like `/feedback` and `/issues/clear` on the daemon.

## Coding Patterns & Conventions
- Schema-Guided Reasoning (SGR): The backend heavily relies on Pydantic models to define JSON schemas, constraining the Gemini API's output to ensure structured, predictable, and validatable responses.
- Multi-threaded Background Processing: The daemon uses a single process with multiple background threads (for Git watching, screen analysis, and state reporting) orchestrated by a main script.
- Centralized In-Memory State with Locking: A global dictionary serves as the single source of truth for the application's state, with access synchronized via a `threading.Lock` to prevent race conditions.
- API Bridge Pattern: The Next.js dashboard provides a simplified, stable API endpoint for the macOS widget, abstracting the more complex and potentially changing backend daemon API.
- Monorepo with Shared Packages: The project is structured as a Turborepo monorepo with pnpm workspaces, allowing code and configuration (UI, ESLint, TypeScript) to be shared across the different apps.
- Environment-based Configuration: Both the Python backend (.env) and Next.js frontend (.env.local) use environment variables for critical configuration like API keys and service URLs.

## Development Setup
Prerequisites are Node.js (>=18), pnpm, and Python (>=3.8). First, clone the repository and run `pnpm install` in the root to install all JavaScript dependencies. Next, set up the Python environment for the backend by navigating to `apps/daemon`, creating a virtual environment (`python3 -m venv venv`), activating it, and running `pip install -r requirements.txt`. Configure the necessary environment variables: create `apps/daemon/.env` and set `GEMINI_API_KEY`. To run the system, start the services in separate terminals. In one terminal, run the Python daemon: `cd apps/daemon && python -m src.daemon /path/to/your/project`. In another terminal, start the Next.js apps from the root directory: `pnpm dev`. This will typically start the landing page on port 3000 and the dashboard on port 3001. The macOS widget can be run from Xcode by opening `apps/widget/VibeAssist/VibeAssist.xcodeproj`.

---
*Last updated from commit: 1c718670*
*This file is automatically maintained by Vibe Assist.*
